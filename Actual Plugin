  <?php 
  /*
  Plugin Name: Unit Converter by Dear
  Plugin URI: https://codecanyon.net/user/tawhidurrahmandear/portfolio/ 
  Description: Go to Appearance > Widgets, and drag 'Unit Converter' inside page or post using pagebuilder. This PlugIn will automatically match your theme's color. No need to use any short-code or to edit settings.
  Version: 9.0
  Author: Tawhidur Rahman Dear
  Author URI: http://www.devilhunter.net/
  License: Commercial

  	Author Introduction:
  	Tawhidur Rahman Dear
  	
  	Founder & CEO
  	Dear IT Solution
  	(IT Consultancy, Web Development, AdSense, SEO, Password Recovery & Security, Online Marketing)
  	 
  	Mailing Address: 
  	House - 304, Road - 10 Rupnagar Tinshed,
      Pallabi, Mirpur,
      Dhaka - 1216
      BANGLADESH
  	
  	http://www.devilhunter.net/
  	dear@devilhunter.net
  	tawhidurrahmandear@gmail.com
      +8801716816283, (also in Viber, DUO, WhatsApp, IMO)
      Skype & Google Hangout: tawhidurrahmandear
      Facebook: http://www.facebook.com/tawhidurrahmandear/ 
      Google Plus: http://plus.google.com/+tawhidurrahmandear/about
      LinkedIn: https://www.linkedin.com/in/tawhidurrahmandear  
  	
  */

  namespace dearthirtysix\dear\wordpress;

  {require_once(__DIR__ . "/pluginfiles/widget.php");}

    class S extends Widget {
      static $widgetTitle = "dearthirtysix_unitconverter";

      public function __construct() {
        parent::__construct(null, "Unit Converter");
      }


      public function widgetContent($args, $instance)
      {
        ?>
  <head>
  <script>

  function unitconverterMain(mode)
  {
    this.version='0.6';w=1000;h=50;
    props=[];units=[];
    currentPropIdx=0;sliderMax=0;unitsFromParams=null;unitsToParams=null;valFrom=0;valTo=0;
    loadUnits();
    var s='';
    s+='<div id="main" style="position:relative; width:'+ w+'px; min-height:'+ h+'px; margin:auto; ">';s+='<div id="wrapper" style="padding:10px;">';
    s+=getPropList(props);s+='<div id="unit-selection"></div>';s+='<button style="width:40%; padding:0px; margin: 15px 0px 15px 60%;" onclick="swapUnits();">Swap Units</button>';
    s+='<div id="slidefull" style="width:100%; text-align: center;padding:3px;">a</div>';s+=getSliderHTML();
    s+='</div>';s+='';document.write(s);document.getElementById('props').selectedIndex=2;onPropsChange();
  }
  function swapUnits()
  {
    var f=document.getElementById('units-from'),t=document.getElementById('units-to');var tmp=t.selectedIndex;t.selectedIndex=f.selectedIndex;f.selectedIndex=tmp;onFromUnitsChange();onToUnitsChange();resetSlider();
  }

  function onPropsChange(){currentPropIdx=document.getElementById('props').selectedIndex;var unitNames=[];var unitNamesOrdered=[];for(var i in units[currentPropIdx]){unitNames.push(units[currentPropIdx][i][0]);}
  var order=props[currentPropIdx][1];for(var i in order){if(unitNames[order[i]])
  unitNamesOrdered.push(unitNames[order[i]]);}
  unitNames=null;var s=getConvertFieldHTML('value-from','onFromValueChange','units-from','onFromUnitsChange','units-from-desc',unitNamesOrdered)+
  getConvertFieldHTML('value-to','onToValueChange','units-to','onToUnitsChange','units-to-desc',unitNamesOrdered);document.getElementById('unit-selection').innerHTML=s;document.getElementById('units-to').selectedIndex=1;onFromUnitsChange();onFromValueChange();onToUnitsChange();onToValueChange();document.getElementById('value-from').value=1;onFromValueChange();resetSlider();}
  function onFromValueChange(){var e=document.getElementById('value-from');valFrom=e.value||0;if(!unitsToParams||!unitsFromParams)return;document.getElementById('value-to').value=fmt(convert(valFrom,unitsFromParams,unitsToParams),15);resetSlider();}
  function onToValueChange(){var e=document.getElementById('value-to');valTo=e.value||0;if(!unitsToParams||!unitsFromParams)return;document.getElementById('value-from').value=fmt(convert(valTo,unitsToParams,unitsFromParams),15);resetSlider();}
  function getConversionParams(unitName){var propUnits=units[currentPropIdx];for(var i in propUnits){if(propUnits[i][0]==unitName){return propUnits[i];}}
  console.log("Unit "+ unitName+" does not exist");return null;}
  function onFromUnitsChange(e){var e=document.getElementById('units-from');var n=e.value;unitsFromParams=getConversionParams(n);document.getElementById("units-from-desc").innerHTML=unitsFromParams[1];onFromValueChange();}
  function onToUnitsChange(e){var e=document.getElementById('units-to');var n=e.value;unitsToParams=getConversionParams(n);document.getElementById("units-to-desc").innerHTML=unitsToParams[1];onFromValueChange();}
  function celsiusToFahrenheit(c){return c*9/5+ 32;}
  function fahrenheitToCelsius(f){return(f- 32)*5/9;}
  function convert(fromVal,fromParams,toParams){if((fromParams[0]=="Degrees Celsius")&&(toParams[0]=="Degrees Fahrenheit")){return celsiusToFahrenheit(fromVal);}
  else if((toParams[0]=="Degrees Celsius")&&(fromParams[0]=="Degrees Fahrenheit")){return fahrenheitToCelsius(fromVal);}
  var v=Number(fromVal);var m=Number(fromParams[2])/ Number(toParams[2]);
  if(isNaN(v))return"...........................";return v*m;}
  function getPropList(props){var s='';s+='<select id="props" onchange="onPropsChange();" style="width:100%; font: 18px Trebchet MS; padding: 6px; border-radius: 6px; height:40px;" >';for(var i=0;i<props.length;i++){var prop=props[i];var idStr='prop'+ i;s+='<option id="'+ idStr+'" style="cursor:pointer; height:18px;" >'+ prop[0][0]+'</div>';}
  s+='</select>';return s;}
  function getDropdownHTML(opts,funcName,id){var s='';s+='<select onchange="'+ funcName+'();" id="'+ id+'" style="min-width:200px; margin-left:10px; font: padding: 1px; border-radius: 6px;" autocomplete="off" >';for(var i=0;i<opts.length;i++){var idStr=id+ i;var chkStr=i==0?'selected':'';s+='<option id="'+ idStr+'" value="'+ opts[i]+'" style="height:18px;" '+ chkStr+' >'+ opts[i]+'</option>';}
  s+='</select>';return s;}
  function resetSlider(){var el=document.getElementById('slider');el.value=.5;sliderMax=document.getElementById('value-from').value*2;onSliderChange();}
  function onSliderChange(){var el=document.getElementById('slider');var aVal=sliderMax*el.value;var bVal=convert(aVal,unitsFromParams,unitsToParams);document.getElementById('slidefull').innerHTML=fmt(aVal,15)+' '+ unitsFromParams[1]+' = '+ fmt(bVal,15)+' '+ unitsToParams[1];}
  function getSliderHTML(){var s='<div style=" padding:3px; margin-bottom:5px; border-radius:6px;">'+'<div style="display:flex; width:100%;">'+'<input id="slider" type="range" min="0" max="1" step=".01" onchange="onSliderChange();" oninput="onSliderChange();" style="flex:1;">'+'</div></div>';return s;}
  function getConvertFieldHTML(inputId,inputFunc,dropdownId,dropdownFunc,postFixId,opts){var s='<div style="display:flex; margin-top:20px;">'+'<div style="border-radius:6px; padding:5px;flex:1; border:2px solid ; ">'+'<input id="'+ inputId+'" style="width:150px; outline:none; border:none;" placeholder="0" onkeyup="resetSlider();'+ inputFunc+'();">'+'<span style="float:right;" id="'+ postFixId+'">xxx</span>'+'</div>'+
  getDropdownHTML(opts,dropdownFunc,dropdownId)+'</div>';return s;}

  function loadUnits()
  {

  props.push([["Force",""],[4,1,6,0],false]);
  units.push([["Dyne","dy",0.00001],["Kilogram force","kgf",9.80665],["Kilopond","kp",9.80665],["Kip","k",4448.2216152605],["Newton","N",1],["Ounce force","ozf",0.27801385095378125],["Pound force","lbf",4.4482216152605],["Poundal","",0.138254954376]]);

  props.push([["Force per length",""],[0,1,2],false]);
  units.push([["Newton/meter","N/m",1],["Pound force/inch","lbf/in",175.1268],["Pound force/foot","lbf/ft",14.5939]]);


  props.push([["Torque",""],[6,0,1,2,3,4,5,6],false]);
  units.push([["Gram-centimeter","g-cm",0.0000980665],["Ounce-inch", "oz-in", 0.00706155183],["Kg force-meter","kg-m",9.80665],["Pound force-inch","lb-in",0.1129848],["Pound force-foot","lb-ft",1.355818],["Kilogram Centimeter", "Kg-cm", .0980665],["Newton-meter","N m",1]]);
  }

  function fmt(num,digits){if(num==Number.POSITIVE_INFINITY)
  return"undefined";if(num==Number.NEGATIVE_INFINITY)
  return"undefined";num=num.toPrecision(digits);num=num.replace(/0+$/,"");if(num.charAt(num.length- 1)==".")num=num.substr(0,num.length- 1);if(Math.abs(num)<1e-15)num=0;return num;}
  </script>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  </head>
  <body>
  <p align="center">
  <script type="text/javascript">unitconverterMain();</script>
  </body>
        <?php
      
      }
    }

    S::register("dearthirtysix_unitconverter");


